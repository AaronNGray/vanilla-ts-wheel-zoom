(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.JcWheelZoom=b())})(this,function(){'use strict';var f=Math.min;function a(a){var b=a.getBoundingClientRect(),c=document,d=c.body,e=c.documentElement,f=window.pageYOffset||e.scrollTop||d.scrollTop,g=window.pageXOffset||e.scrollLeft||d.scrollLeft,h=e.clientTop||d.clientTop||0,i=e.clientLeft||d.clientLeft||0,j=b.top+f-h,k=b.left+g-i;return{top:j,left:k}}function b(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a){var c=Math.abs;function b(a){for(var b=[],c=a.length-1;0<=c;c--)for(var d=0;d<a[c];d++)b.push((c+1)*h);return b}var d=24,e=2,f=[20,7,6,5,4],g=[],h=0<a?1:-1,j=2*c(a);j=j&&j>d?d:j,j=j&&j<e?e:j,a=j/2*h;for(var k=0;k<j-f.length;k++)g.push(2*a-k*h);return g.length?g.concat(b(f)):[]}function d(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.dropHandler=this.dropHandler.bind(this),this.grabHandler=this.grabHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.options=b({smoothExtinction:!0,onGrab:null,onMove:null,onDrop:null},c),this.scrollable=a,this.scrollable.addEventListener("mousedown",this.grabHandler)}function e(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._rescale=this._rescale.bind(this);this.image=document.querySelector(a),this.options=b({dragScrollable:!0,dragScrollableOptions:{},maxScale:1,speed:10},c),null!==this.image&&(this.window=this.image.parentNode,this.image.complete?this._init():this.image.onload=this._init)}return d.prototype={constructor:d,scrollable:null,moveTimer:null,options:{},isGrab:!1,coords:null,speed:null,grabHandler:function(a){return a.preventDefault(),1===a.buttons&&void(this.isGrab=!0,this.coords={left:a.clientX,top:a.clientY},this.speed={x:0,y:0},document.addEventListener("mouseup",this.dropHandler),document.addEventListener("mousemove",this.moveHandler),"function"==typeof this.options.onGrab&&this.options.onGrab())},dropHandler:function(a){if(a.preventDefault(),this.isGrab=!1,this.options.smoothExtinction){var b=function a(b,c){!this.isGrab&&c.length&&(this.scrollable[b]-=c.shift(),c.length&&window.requestAnimationFrame(a.bind(this,b,c)))};b.bind(this)("scrollLeft",c(this.speed.x)),b.bind(this)("scrollTop",c(this.speed.y))}document.removeEventListener("mouseup",this.dropHandler),document.removeEventListener("mousemove",this.moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop()},moveHandler:function(a){a.preventDefault(),this.speed.x=a.clientX-this.coords.left,this.speed.y=a.clientY-this.coords.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){this.speed={x:0,y:0}}.bind(this),50),this.scrollable.scrollLeft-=this.speed.x,this.scrollable.scrollTop-=this.speed.y,this.coords={left:a.clientX,top:a.clientY},"function"==typeof this.options.onMove&&this.options.onMove()}},e.prototype={constructor:e,image:null,container:null,window:null,original:{image:{},window:{}},options:null,correctX:null,correctY:null,_init:function(){this.original.image={width:this.image.offsetWidth,height:this.image.offsetHeight},this.container=document.createElement("div"),this.window.appendChild(this.container),this.container.appendChild(this.image),this._prepare(),!0===this.options.dragScrollable&&new d(this.window,this.options.dragScrollableOptions),this.window.addEventListener("wheel",this._rescale),window.addEventListener("resize",this._rescale)},_prepare:function(){var a=Math.max;this.original.window={width:this.window.offsetWidth,height:this.window.offsetHeight};var b=f(this.original.window.width/this.original.image.width,this.original.window.height/this.original.image.height);this.correctX=a(0,(this.original.window.width-this.original.image.width*b)/2),this.correctY=a(0,(this.original.window.height-this.original.image.height*b)/2),this.image.width=this.original.image.width*b,this.image.height=this.original.image.height*b,this.image.style.marginLeft="".concat(this.correctX,"px"),this.image.style.marginTop="".concat(this.correctY,"px"),this.container.style.width="".concat(this.image.width+2*this.correctX,"px"),this.container.style.height="".concat(this.image.height+2*this.correctY,"px"),"function"==typeof this.options.prepare&&this.options.prepare(b,this.correctX,this.correctY)},_rescale:function(b){var c=Math.round;b.preventDefault();var d=0>b.deltaY?1:-1,e=this.image.width,g=this.image.height,h=e/this.original.image.width,i=f(this.original.window.width/this.original.image.width,this.original.window.height/this.original.image.height),j=h+d/this.options.speed;j=j<i?i:j>this.options.maxScale?this.options.maxScale:j;var k=this.window.scrollLeft,l=this.window.scrollTop,m=this.image.width=this.original.image.width*j,n=this.image.height=this.original.image.height*j,o=m+2*this.correctX,p=n+2*this.correctY;this.container.style.width="".concat(o,"px"),this.container.style.height="".concat(p,"px"),"function"==typeof this.options.rescale&&this.options.rescale(j,this.correctX,this.correctY,i);var q=this.window.scrollLeft,r=this.window.scrollTop,s=a(this.window),t=c(b.pageX-s.left+this.window.scrollLeft-this.correctX),u=c(m*t/e);this.window.scrollLeft+=u-t+(k-q);var v=c(b.pageY-s.top+this.window.scrollTop-this.correctY),w=c(n*v/g);this.window.scrollTop+=w-v+(l-r)},prepare:function(){this._prepare()},zoomUp:function(){var b=a(this.window),c=new Event("wheel");c.deltaY=-1,c.pageX=b.left+this.original.window.width/2,c.pageY=b.top+this.original.window.height/2,this._rescale(c)},zoomDown:function(){var b=a(this.window),c=new Event("wheel");c.deltaY=1,c.pageX=b.left+this.original.window.width/2,c.pageY=b.top+this.original.window.height/2,this._rescale(c)}},e.create=function(a,b){return new e(a,b)},e});