!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=e()}(this,(function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function e(e){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?t(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var o,i,r=[],s=!0,c=!1;try{for(n=n.call(t);!(s=(o=n.next()).done)&&(r.push(o.value),!e||r.length!==e);s=!0);}catch(t){c=!0,i=t}finally{try{s||null==n.return||n.return()}finally{if(c)throw i}}return r}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function s(t){var e=t.getBoundingClientRect(),n=document,o=n.body,i=n.documentElement,r=h(),s=c(),a=i.clientTop||o.clientTop||0,l=i.clientLeft||o.clientLeft||0;return{top:e.top+r-a,left:e.left+s-l}}function c(){var t=void 0!==window.pageXOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft}function h(){var t=void 0!==window.pageYOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop}function a(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function l(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(e,n,o)}function u(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.removeEventListener(e,n,o)}function p(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function d(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function m(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function f(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),n.smoothExtinction=Number(n.smoothExtinction)||.25,this.options=a({smoothExtinction:.25,onGrab:null,onMove:null,onDrop:null},n),this.isTouch=p(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},this.window=t,this.content=e,l(this.content.$element,this.events.grab,this._grabHandler,this.events.options)}f.prototype={constructor:f,window:null,content:null,isTouch:!1,isGrab:!1,events:null,moveTimer:null,options:{},coordinates:null,speed:null,_grabHandler:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(t.preventDefault(),this.isGrab=!0,this.coordinates={left:d(t),top:m(t)},this.speed={x:0,y:0},l(document,this.events.drop,this._dropHandler,this.events.options),l(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab(t))},_dropHandler:function(t){t.preventDefault(),this.isGrab=!1,u(document,this.events.drop,this._dropHandler),u(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop(t)},_moveHandler:function(t){if(this.isTouch&&t.touches.length>1)return!1;t.preventDefault();var e=this.window,n=this.content,o=this.speed,i=this.coordinates,r=this.options;o.x=d(t)-i.left,o.y=m(t)-i.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){o.x=0,o.y=0}),50);var s=n.currentLeft+o.x,c=n.currentTop+o.y,h=(n.currentWidth-e.originalWidth)/2+n.correctX,a=(n.currentHeight-e.originalHeight)/2+n.correctY;Math.abs(s)<=h&&(n.currentLeft=s),Math.abs(c)<=a&&(n.currentTop=c),function(t,e,n){var o=e.left,i=e.top,r=e.scale;n.smoothExtinction?t.style.transition="transform ".concat(n.smoothExtinction,"s"):t.style.removeProperty("transition");t.style.transform="translate3d(".concat(o,"px, ").concat(i,"px, 0px) scale(").concat(r,")")}(n.$element,{left:n.currentLeft,top:n.currentTop,scale:n.currentScale},this.options),i.left=d(t),i.top=m(t),"function"==typeof r.onMove&&r.onMove(t)},destroy:function(){for(var t in u(this.content.$element,this.events.grab,this._grabHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}};var g="dblclick",w="wheel";function v(t){this.target=t,this.subscribes={},this.coordsOnDown=null,this.pressingTimeout=null,this.firstClick=!0,this.fingersHypot=null,this.zoomPinchWasDetected=!1,this.isTouch=p(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this._downHandler=this._downHandler.bind(this),this._upHandler=this._upHandler.bind(this),this._wheelHandler=this._wheelHandler.bind(this),this._zoomTwoFingers_TouchmoveHandler=this._zoomTwoFingers_TouchmoveHandler.bind(this),this._zoomTwoFingers_TouchendHandler=this._zoomTwoFingers_TouchendHandler.bind(this),l(this.target,this.events.down,this._downHandler,this.events.options),l(this.target,this.events.up,this._upHandler,this.events.options),l(this.target,w,this._wheelHandler),this.isTouch&&(l(this.target,"touchmove",this._zoomTwoFingers_TouchmoveHandler),l(this.target,"touchend",this._zoomTwoFingers_TouchendHandler))}function b(t,e,n,o,i,r){var s=i/2-(t+e-n)+o;return s*r-s+o}function y(t,e,n,o,i){switch(t.alignContent){case"left":o/2-i<e/2&&(i=(o-e)/2);break;case"right":o/2+i<e/2&&(i=(o-e)/2*-1);break;default:if((o-e)/2+n<Math.abs(i))i=((o-e)/2+n)*(i<0?-1:1)}return i}function _(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeNewScale=this._computeNewScale.bind(this),this._computeNewPosition=this._computeNewPosition.bind(this),this._transform=this._transform.bind(this),this.content={},this.window={},this.isTouch=!1,this.direction=1,this.options=null,this.dragScrollable=null,this.content.elementInteracter=null;var n={type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},minScale:null,maxScale:1,speed:50,zoomOnClick:!0,zoomOnDblClick:!1,watchImageChange:!0,smoothExtinction:.3,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1};if("string"==typeof t)this.content.$element=document.querySelector(t);else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}if(this.isTouch=p(),this.content.$element)if(e.smoothExtinction=Number(e.smoothExtinction)||n.smoothExtinction,this.options=a(n,e),this.options.minScale&&this.options.minScale>=this.options.maxScale&&(this.options.minScale=null),this.window.$element=this.content.$element.parentNode,"image"===this.options.type){var o=!1;this.content.$element.complete&&(this._init(),o=!0),o&&!0!==this.options.watchImageChange||l(this.content.$element,"load",this._init,!this.options.watchImageChange&&{once:!0})}else this._init()}return v.prototype={constructor:v,on:function(t,e){return t in this.subscribes||(this.subscribes[t]=[]),this.subscribes[t].push(e),this},run:function(t,e){if(this.subscribes[t]){var n,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,c=!0,h=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){h=!0,s=t},f:function(){try{c||null==n.return||n.return()}finally{if(h)throw s}}}}(this.subscribes[t]);try{for(o.s();!(n=o.n()).done;){(0,n.value)(e)}}catch(t){o.e(t)}finally{o.f()}}},destroy:function(){for(var t in u(this.target,this.events.down,this._downHandler,this.events.options),u(this.target,this.events.up,this._upHandler,this.events.options),u(this.target,w,this._wheelHandler,this.events.options),this.isTouch&&(u(this.target,"touchmove",this._zoomTwoFingers_TouchmoveHandler),u(this.target,"touchend",this._zoomTwoFingers_TouchendHandler)),this)this.hasOwnProperty(t)&&(this[t]=null)},_downHandler:function(t){this.coordsOnDown=null,(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnDown={x:d(t),y:m(t)}),clearTimeout(this.pressingTimeout)},_upHandler:function(t){var e=this,n=this.subscribes.dblclick?200:0;this.firstClick?(this.pressingTimeout=setTimeout((function(){e.coordsOnDown&&e.coordsOnDown.x===d(t)&&e.coordsOnDown.y===m(t)&&e.run("click",t),e.firstClick=!0}),n),this.firstClick=!1):this.pressingTimeout=setTimeout((function(){e.run(g,t),e.firstClick=!0}),n/2)},_wheelHandler:function(t){this.run(w,t)},_zoomTwoFingers_TouchmoveHandler:function(t){if(2===t.targetTouches.length){var n=t.targetTouches[0].clientX,o=t.targetTouches[0].clientY,i=t.targetTouches[1].clientX,r=t.targetTouches[1].clientY,s=Math.round(Math.sqrt(Math.pow(Math.abs(n-i),2)+Math.pow(Math.abs(o-r),2))),c=0;if(s>this.fingersHypot+5&&(c=-1),s<this.fingersHypot-5&&(c=1),0!==c){if(null!==this.fingersHypot||1===c){var h=Math.min(n,i)+Math.abs(n-i)/2,a=Math.min(o,r)+Math.abs(o-r)/2;t.data=e(e({},t.data||{}),{},{clientX:h,clientY:a,direction:c}),this.run("pinchtozoom",t)}this.fingersHypot=s,this.zoomPinchWasDetected=!0}}},_zoomTwoFingers_TouchendHandler:function(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}},_.prototype={constructor:_,_init:function(){var t=this;if(this._prepare(),this.content.elementInteracter&&this.content.elementInteracter.destroy(),this.content.elementInteracter=new v(this.content.$element),!0===this.options.dragScrollable&&(this.dragScrollable&&this.dragScrollable.destroy(),this.setDragScrollable(new f(this.window,this.content,this.options.dragScrollableOptions))),this.options.disableWheelZoom||(this.isTouch&&this.content.elementInteracter.on("pinchtozoom",(function(e){var n=e.data,o=n.clientX,i=n.clientY,r=n.direction;t._transform(t._computeNewPosition(t._computeNewScale(r),{x:o,y:i}))})),this.content.elementInteracter.on("wheel",(function(e){e.preventDefault();var n=t.options.reverseWheelDirection?-e.deltaY:e.deltaY;t._transform(t._computeNewPosition(t._computeNewScale(n),{x:d(e),y:m(e)}))}))),this.options.zoomOnClick||this.options.zoomOnDblClick){var e=this.options.zoomOnDblClick?"dblclick":"click";this.content.elementInteracter.on(e,(function(e){t._transform(t._computeNewPosition(1===t.direction?t.content.maxScale:t.content.minScale,{x:d(e),y:m(e)})),t.direction*=-1}))}},_prepare:function(){var t=s(this.window.$element);this.window.originalWidth=this.window.$element.offsetWidth,this.window.originalHeight=this.window.$element.offsetHeight,this.window.positionLeft=t.left,this.window.positionTop=t.top,"image"===this.options.type?(this.content.originalWidth=this.options.width||this.content.$element.naturalWidth,this.content.originalHeight=this.options.height||this.content.$element.naturalHeight):(this.content.originalWidth=this.options.width||this.content.$element.offsetWidth,this.content.originalHeight=this.options.height||this.content.$element.offsetHeight),this.content.minScale=this.options.minScale||Math.min(this.window.originalWidth/this.content.originalWidth,this.window.originalHeight/this.content.originalHeight),this.content.maxScale=this.options.maxScale,this.content.currentWidth=this.content.originalWidth*this.content.minScale,this.content.currentHeight=this.content.originalHeight*this.content.minScale;var e=function(t,e,n){var o=0,i=0;switch(t.alignContent){case"left":o=(e.currentWidth-n.originalWidth)/2;break;case"top":i=(e.currentHeight-n.originalHeight)/2;break;case"right":o=(e.currentWidth-n.originalWidth)/2*-1;break;case"bottom":i=(e.currentHeight-n.originalHeight)/2*-1}return[o,i]}(this.options,this.content,this.window),n=o(e,2),i=n[0],r=n[1];this.content.alignPointX=i,this.content.alignPointY=r;var c=function(t,e,n){var o=Math.max(0,(n.originalWidth-e.currentWidth)/2),i=Math.max(0,(n.originalHeight-e.currentHeight)/2);return"left"===t.alignContent?o*=2:"right"===t.alignContent&&(o=0),"bottom"===t.alignContent?i*=2:"top"===t.alignContent&&(i=0),[o,i]}(this.options,this.content,this.window),h=o(c,2),a=h[0],l=h[1];this.content.correctX=a,this.content.correctY=l,this.content.currentLeft=this.content.alignPointX,this.content.currentTop=this.content.alignPointY,this.content.currentScale=this.content.minScale,this.content.$element.style.transform="translate3d(".concat(this.content.alignPointX,"px, ").concat(this.content.alignPointY,"px, 0px) scale(").concat(this.content.minScale,")"),"function"==typeof this.options.prepare&&this.options.prepare()},_computeNewScale:function(t){this.direction=t<0?1:-1;var e=this.content,n=e.minScale,o=e.maxScale,i=e.currentScale+this.direction/this.options.speed;return i<n?this.direction=1:i>o&&(this.direction=-1),i<n?n:i>o?o:i},_computeNewPosition:function(t,e){var n=e.x,o=e.y,i=this.window,r=this.content,s=r.originalWidth*t,a=r.originalHeight*t,l=c(),u=h(),p=b(n,l,i.positionLeft,r.currentLeft,i.originalWidth,s/r.currentWidth),d=b(o,u,i.positionTop,r.currentTop,i.originalHeight,a/r.currentHeight);-1===this.direction&&(p=y(this.options,i.originalWidth,r.correctX,s,p),d=y(this.options,i.originalHeight,r.correctY,a,d)),t===this.content.minScale&&(p=this.content.alignPointX,d=this.content.alignPointY);var m={currentLeft:r.currentLeft,newLeft:p,currentTop:r.currentTop,newTop:d,currentScale:r.currentScale,newScale:t};return r.currentWidth=s,r.currentHeight=a,r.currentLeft=p,r.currentTop=d,r.currentScale=t,m},_transform:function(t){t.currentLeft;var e=t.newLeft;t.currentTop;var n=t.newTop;t.currentScale;var o=t.newScale;this.options.smoothExtinction?this.content.$element.style.transition="transform ".concat(this.options.smoothExtinction,"s"):this.content.$element.style.removeProperty("transition"),this.content.$element.style.transform="translate3d(".concat(e,"px, ").concat(n,"px, 0px) scale(").concat(o,")"),"function"==typeof this.options.rescale&&this.options.rescale()},_zoom:function(t,e){void 0!==e&&void 0!==e.x&&void 0!==e.y||(e=function(t){var e=s(t.$element);return{x:e.left+t.originalWidth/2-c(),y:e.top+t.originalHeight/2-h()}}(this.window)),this._transform(this._computeNewPosition(t,e))},prepare:function(){this._prepare()},zoomUp:function(){this._zoom(this._computeNewScale(-1))},zoomDown:function(){this._zoom(this._computeNewScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},zoomUpToPoint:function(t){this._zoom(this._computeNewScale(-1),t)},zoomDownToPoint:function(t){this._zoom(this._computeNewScale(1),t)},maxZoomUpToPoint:function(t){this._zoom(this.content.maxScale,t)},setDragScrollable:function(t){this.dragScrollable=t},destroy:function(){for(var t in this.content.$element.style.transform="","image"===this.options.type&&u(this.content.$element,"load",this._init),this.content.elementInteracter&&this.content.elementInteracter.destroy(),this.dragScrollable&&this.dragScrollable.destroy(),this)this.hasOwnProperty(t)&&(this[t]=null)}},_.create=function(t,e){return new _(t,e)},_}));