!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=e()}(this,(function(){"use strict";function t(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var o,i,s=[],r=!0,h=!1;try{for(n=n.call(t);!(r=(o=n.next()).done)&&(s.push(o.value),!e||s.length!==e);r=!0);}catch(t){h=!0,i=t}finally{try{r||null==n.return||n.return()}finally{if(h)throw i}}return s}(t,n)||function(t,n){if(!t)return;if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return e(t,n)}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function n(t){var e=t.getBoundingClientRect(),n=document,s=n.body,r=n.documentElement,h=i(),c=o(),a=r.clientTop||s.clientTop||0,l=r.clientLeft||s.clientLeft||0;return{top:e.top+h-a,left:e.left+c-l}}function o(){var t=void 0!==window.pageXOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft}function i(){var t=void 0!==window.pageYOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop}function s(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function r(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(e,n,o)}function h(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.removeEventListener(e,n,o)}function c(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function a(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function l(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),n.smoothExtinction=Number(n.smoothExtinction),isNaN(n.smoothExtinction)&&(n.smoothExtinction=.25),this.options=s({smoothExtinction:.25,onGrab:null,onMove:null,onDrop:null},n),this.isTouch=c(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},this.window=t,this.content=e,r(this.content.$element,this.events.grab,this._grabHandler,this.events.options)}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeNewScale=this._computeNewScale.bind(this),this._computeNewPosition=this._computeNewPosition.bind(this),this._transform=this._transform.bind(this),this._wheelHandler=m.bind(this),this._downHandler=d.bind(this),this._upHandler=f.bind(this),this._zoomTwoFingers_TouchmoveHandler=g.bind(this),this._zoomTwoFingers_TouchendHandler=w.bind(this),this.content={},this.window={},this.isTouch=!1,this.events=null,this.direction=1,this.options=null,this.dragScrollable=null,this.coordsOnMouseDown=null;var n={type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},minScale:null,maxScale:1,speed:50,zoomOnClick:!0,watchImageChange:!0,smoothExtinction:.3,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1};if("string"==typeof t)this.content.$element=document.querySelector(t);else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}if(this.isTouch=c(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this.content.$element)if(e.smoothExtinction=Number(e.smoothExtinction)||n.smoothExtinction,this.options=s(n,e),this.options.minScale&&this.options.minScale>=this.options.maxScale&&(this.options.minScale=null),this.window.$element=this.content.$element.parentNode,"image"===this.options.type){var o=!1;this.content.$element.complete&&(this._init(),o=!0),o&&!0!==this.options.watchImageChange||r(this.content.$element,"load",this._init,!this.options.watchImageChange&&{once:!0})}else this._init()}function m(t){t.preventDefault();var e=this.options.reverseWheelDirection?-t.deltaY:t.deltaY;this._transform(this._computeNewPosition(this._computeNewScale(e),{x:a(t),y:l(t)}))}function d(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnMouseDown={x:a(t),y:l(t)})}function f(t){var e=a(t),n=l(t);this.coordsOnMouseDown&&this.coordsOnMouseDown.x===e&&this.coordsOnMouseDown.y===n&&(this._transform(this._computeNewPosition(1===this.direction?this.content.maxScale:this.content.minScale,{x:e,y:n})),this.direction*=-1),this.coordsOnMouseDown=null}function g(t){if(2===t.targetTouches.length){var e=t.targetTouches[0].clientX,n=t.targetTouches[0].clientY,o=t.targetTouches[1].clientX,i=t.targetTouches[1].clientY,s=Math.round(Math.sqrt(Math.pow(Math.abs(e-o),2)+Math.pow(Math.abs(n-i),2))),r=0;if(s>this.fingersHypot+5&&(r=-1),s<this.fingersHypot-5&&(r=1),0!==r){if(null!==this.fingersHypot||1===r){var h=Math.min(e,o)+Math.abs(e-o)/2,c=Math.min(n,i)+Math.abs(n-i)/2;this._transform(this._computeNewPosition(this._computeNewScale(r),{x:h,y:c}))}this.fingersHypot=s,this.zoomPinchWasDetected=!0}}}function w(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}function v(t,e,n,o,i,s){var r=i/2-(t+e-n)+o;return r*s-r+o}function y(t,e,n,o,i){switch(t.alignContent){case"left":o/2-i<e/2&&(i=(o-e)/2);break;case"right":o/2+i<e/2&&(i=(o-e)/2*-1);break;default:if((o-e)/2+n<Math.abs(i))i=((o-e)/2+n)*(i<0?-1:1)}return i}return u.prototype={constructor:u,window:null,content:null,isTouch:!1,isGrab:!1,events:null,moveTimer:null,options:{},coordinates:null,speed:null,_grabHandler:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(t.preventDefault(),this.isGrab=!0,this.coordinates={left:a(t),top:l(t)},this.speed={x:0,y:0},r(document,this.events.drop,this._dropHandler,this.events.options),r(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab(t))},_dropHandler:function(t){t.preventDefault(),this.isGrab=!1,h(document,this.events.drop,this._dropHandler),h(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop(t)},_moveHandler:function(t){if(this.isTouch&&t.touches.length>1)return!1;t.preventDefault();var e=this.window,n=this.content,o=this.speed,i=this.coordinates,s=this.options;o.x=a(t)-i.left,o.y=l(t)-i.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){o.x=0,o.y=0}),50);var r=n.currentLeft+o.x,h=n.currentTop+o.y,c=(n.currentWidth-e.originalWidth)/2+n.correctX,u=(n.currentHeight-e.originalHeight)/2+n.correctY;Math.abs(r)<=c&&(n.currentLeft=r),Math.abs(h)<=u&&(n.currentTop=h),function(t,e,n){var o=e.left,i=e.top,s=e.scale;n.smoothExtinction?t.style.transition="transform ".concat(n.smoothExtinction,"s"):t.style.removeProperty("transition");t.style.transform="translate3d(".concat(o,"px, ").concat(i,"px, 0px) scale(").concat(s,")")}(n.$element,{left:n.currentLeft,top:n.currentTop,scale:n.currentScale},this.options),i.left=a(t),i.top=l(t),"function"==typeof s.onMove&&s.onMove(t)},destroy:function(){for(var t in h(this.content.$element,this.events.grab,this._grabHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}},p.prototype={constructor:p,_init:function(){this._prepare(),!0===this.options.dragScrollable&&(this.dragScrollable&&this.dragScrollable.destroy(),this.setDragScrollable(new u(this.window,this.content,this.options.dragScrollableOptions))),this.options.disableWheelZoom||(this.isTouch&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1,r(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),r(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),r(this.content.$element,"wheel",this._wheelHandler)),this.options.zoomOnClick&&(r(this.content.$element,this.events.down,this._downHandler,this.events.options),r(this.content.$element,this.events.up,this._upHandler,this.events.options))},_prepare:function(){var e=n(this.window.$element);this.window.originalWidth=this.window.$element.offsetWidth,this.window.originalHeight=this.window.$element.offsetHeight,this.window.positionLeft=e.left,this.window.positionTop=e.top,"image"===this.options.type?(this.content.originalWidth=this.options.width||this.content.$element.naturalWidth,this.content.originalHeight=this.options.height||this.content.$element.naturalHeight):(this.content.originalWidth=this.options.width||this.content.$element.offsetWidth,this.content.originalHeight=this.options.height||this.content.$element.offsetHeight),this.content.minScale=this.options.minScale||Math.min(this.window.originalWidth/this.content.originalWidth,this.window.originalHeight/this.content.originalHeight),this.content.maxScale=this.options.maxScale,this.content.currentWidth=this.content.originalWidth*this.content.minScale,this.content.currentHeight=this.content.originalHeight*this.content.minScale;var o=function(t,e,n){var o=0,i=0;switch(t.alignContent){case"left":o=(e.currentWidth-n.originalWidth)/2;break;case"top":i=(e.currentHeight-n.originalHeight)/2;break;case"right":o=(e.currentWidth-n.originalWidth)/2*-1;break;case"bottom":i=(e.currentHeight-n.originalHeight)/2*-1}return[o,i]}(this.options,this.content,this.window),i=t(o,2),s=i[0],r=i[1];this.content.alignPointX=s,this.content.alignPointY=r;var h=function(t,e,n){var o=Math.max(0,(n.originalWidth-e.currentWidth)/2),i=Math.max(0,(n.originalHeight-e.currentHeight)/2);"left"===t.alignContent?o*=2:"right"===t.alignContent&&(o=0);"bottom"===t.alignContent?i*=2:"top"===t.alignContent&&(i=0);return[o,i]}(this.options,this.content,this.window),c=t(h,2),a=c[0],l=c[1];this.content.correctX=a,this.content.correctY=l,this.content.currentLeft=this.content.alignPointX,this.content.currentTop=this.content.alignPointY,this.content.currentScale=this.content.minScale,this.content.$element.style.transform="translate3d(".concat(this.content.alignPointX,"px, ").concat(this.content.alignPointY,"px, 0px) scale(").concat(this.content.minScale,")"),"function"==typeof this.options.prepare&&this.options.prepare()},_computeNewScale:function(t){this.direction=t<0?1:-1;var e=this.content,n=e.minScale,o=e.maxScale,i=e.currentScale+this.direction/this.options.speed;return i<n?this.direction=1:i>o&&(this.direction=-1),i<n?n:i>o?o:i},_computeNewPosition:function(t,e){var n=e.x,s=e.y,r=this.window,h=this.content,c=h.originalWidth*t,a=h.originalHeight*t,l=o(),u=i(),p=v(n,l,r.positionLeft,h.currentLeft,r.originalWidth,c/h.currentWidth),m=v(s,u,r.positionTop,h.currentTop,r.originalHeight,a/h.currentHeight);-1===this.direction&&(p=y(this.options,r.originalWidth,h.correctX,c,p),m=y(this.options,r.originalHeight,h.correctY,a,m)),t===this.content.minScale&&(p=this.content.alignPointX,m=this.content.alignPointY);var d={currentLeft:h.currentLeft,newLeft:p,currentTop:h.currentTop,newTop:m,currentScale:h.currentScale,newScale:t};return h.currentWidth=c,h.currentHeight=a,h.currentLeft=p,h.currentTop=m,h.currentScale=t,d},_transform:function(t){t.currentLeft;var e=t.newLeft;t.currentTop;var n=t.newTop;t.currentScale;var o=t.newScale;this.options.smoothExtinction?this.content.$element.style.transition="transform ".concat(this.options.smoothExtinction,"s"):this.content.$element.style.removeProperty("transition"),this.content.$element.style.transform="translate3d(".concat(e,"px, ").concat(n,"px, 0px) scale(").concat(o,")"),"function"==typeof this.options.rescale&&this.options.rescale()},_zoom:function(t,e){void 0!==e&&void 0!==e.x&&void 0!==e.y||(e=function(t){var e=n(t.$element);return{x:e.left+t.originalWidth/2-o(),y:e.top+t.originalHeight/2-i()}}(this.window)),this._transform(this._computeNewPosition(t,e))},prepare:function(){this._prepare()},zoomUp:function(){this._zoom(this._computeNewScale(-1))},zoomDown:function(){this._zoom(this._computeNewScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},zoomUpToPoint:function(t){this._zoom(this._computeNewScale(-1),t)},zoomDownToPoint:function(t){this._zoom(this._computeNewScale(1),t)},maxZoomUpToPoint:function(t){this._zoom(this.content.maxScale,t)},setDragScrollable:function(t){this.dragScrollable=t},destroy:function(){for(var t in this.content.$element.style.transform="","image"===this.options.type&&h(this.content.$element,"load",this._init),this.options.disableWheelZoom||(this.isTouch&&(h(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),h(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),h(this.content.$element,"wheel",this._wheelHandler)),this.options.zoomOnClick&&(h(this.content.$element,this.events.down,this._downHandler,this.events.options),h(this.content.$element,this.events.up,this._upHandler,this.events.options)),this.dragScrollable&&this.dragScrollable.destroy(),this)this.hasOwnProperty(t)&&(this[t]=null)}},p.create=function(t,e){return new p(t,e)},p}));