(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.JcWheelZoom=b())})(this,function(){'use strict';function a(a){var b=a.getBoundingClientRect(),c=document,d=c.body,e=c.documentElement,f=window.pageYOffset||e.scrollTop||d.scrollTop,g=window.pageXOffset||e.scrollLeft||d.scrollLeft,h=e.clientTop||d.clientTop||0,i=e.clientLeft||d.clientLeft||0,j=b.top+f-h,k=b.left+g-i;return{top:j,left:k}}function b(a,b){if(a&&b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,b,c){var d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];a.addEventListener(b,c,d)}function d(a,b,c){var d=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];a.removeEventListener(b,c,d)}function e(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints}function f(a){return"wheel"===a.type||"mousedown"===a.type||"mousemove"===a.type||"mouseup"===a.type?a.clientX:a.changedTouches[0].clientX}function g(a){return"wheel"===a.type||"mousedown"===a.type||"mousemove"===a.type||"mouseup"===a.type?a.clientY:a.changedTouches[0].clientY}function h(a){var b=a.style.transform.match(/^translate3d\((-?\d+(?:.\d+)?)px, (-?\d+(?:.\d+)?)px, 0px\) scale\((\d+(?:.\d+)?)\)$/);return b?{left:parseFloat(b[1]),top:parseFloat(b[2]),scale:parseFloat(b[3])}:{left:null,top:null,scale:null}}function i(a,d){var f=this,g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),this.options=b({smoothExtinction:!1,onGrab:null,onMove:null,onDrop:null},g),this.isTouch=e(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this.$window=a,this.$content=d,c(this.$content,this.events.grab,function(a){(f.isTouch&&1===a.touches.length||1===a.buttons)&&f._grabHandler(a)},this.events.options)}function j(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeNewScale=this._computeNewScale.bind(this),this._computeNewPosition=this._computeNewPosition.bind(this),this._transform=this._transform.bind(this);this.content.$element=document.querySelector(a),this.isTouch=e(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this.content.$element&&(this.options=b({type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},maxScale:1,speed:50},c),this.window.$element=this.content.$element.parentNode,"image"===this.options.type?this.content.$element.complete?this._init():this.content.$element.onload=this._init:this._init())}return i.prototype={constructor:i,$window:null,$content:null,isTouch:!1,isGrab:!1,events:null,moveTimer:null,options:{},coordinates:null,speed:null,_grabHandler:function(a){this.isTouch||a.preventDefault(),this.isGrab=!0,this.coordinates={left:f(a),top:g(a)},this.speed={x:0,y:0},c(document,this.events.drop,this._dropHandler,this.events.options),c(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab()},_dropHandler:function(a){this.isTouch||a.preventDefault(),this.isGrab=!1,d(document,this.events.drop,this._dropHandler),d(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop()},_moveHandler:function(a){this.isTouch||a.preventDefault(),this.speed.x=f(a)-this.coordinates.left,this.speed.y=g(a)-this.coordinates.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout(function(){this.speed={x:0,y:0}}.bind(this),50);var b=h(this.$content);if(b.left||b.top){var c=b.left+this.speed.x,d=b.top+this.speed.y;this._transform(c,d,b.scale)}this.coordinates={left:f(a),top:g(a)},"function"==typeof this.options.onMove&&this.options.onMove()},_transform:function(a,b,c){this.$content.style.transform="translate3d(".concat(a,"px, ").concat(b,"px, 0px) scale(").concat(c,")")}},j.prototype={constructor:j,isTouch:!1,events:null,content:{},window:{},direction:1,options:null,correctX:null,correctY:null,stack:[],_init:function(){var a=this;this._prepare(),!0===this.options.dragScrollable&&(this.options.dragScrollableOptions.correctX=this.correctX,this.options.dragScrollableOptions.correctY=this.correctY,new i(this.window.$element,this.content.$element,this.options.dragScrollableOptions)),c(this.window.$element,"wheel",function(b){b.preventDefault(),a._transform(a._computeNewPosition(a._computeNewScale(b.deltaY),{x:f(b),y:g(b)}))}),c(self,"resize",function(b){b.preventDefault(),a._prepare()});var b=!0;c(this.window.$element,this.events.down,function(a){1===a.buttons&&(b=!1,setTimeout(function(){return b=!0},150))},this.events.options),c(this.window.$element,this.events.up,function(c){var d=h(a.content.$element);a.content.currentLeft=d.left,a.content.currentTop=d.top,b||(a._transform(a._computeNewPosition(1===a.direction?a.content.maxScale:a.content.minScale,{x:f(c),y:g(c)})),a.direction*=-1)},this.events.options)},_prepare:function(){var b=Math.max,c=Math.min,d=a(this.window.$element);this.window.originalWidth=this.window.$element.offsetWidth,this.window.originalHeight=this.window.$element.offsetHeight,this.window.positionLeft=d.left,this.window.positionTop=d.top,"image"===this.options.type?(this.content.originalWidth=this.options.width||this.content.$element.naturalWidth,this.content.originalHeight=this.options.height||this.content.$element.naturalHeight):(this.content.originalWidth=this.options.width||this.content.$element.offsetWidth,this.content.originalHeight=this.options.height||this.content.$element.offsetHeight),this.content.minScale=c(this.window.originalWidth/this.content.originalWidth,this.window.originalHeight/this.content.originalHeight),this.content.maxScale=this.options.maxScale,this.content.currentWidth=this.content.originalWidth*this.content.minScale,this.content.currentHeight=this.content.originalHeight*this.content.minScale,this.content.currentLeft=0,this.content.currentTop=0,this.content.currentScale=this.content.minScale,this.correctX=b(0,(this.window.originalWidth-this.content.currentWidth)/2),this.correctY=b(0,(this.window.originalHeight-this.content.currentHeight)/2),this.content.$element.style.transform="translate3d(0px, 0px, 0px) scale(".concat(this.content.minScale,")")},_computeNewScale:function(a){this.direction=0>a?1:-1;var b=this.content,c=b.minScale,d=b.maxScale,e=b.currentScale,f=e+this.direction/this.options.speed;return f<c?c:f>d?d:f},_computeNewPosition:function(a,b){var c=Math.abs,d=b.x,e=b.y,f=this.window,g=this.content,h=this.correctX,i=this.correctY,j=g.originalWidth*a,k=g.originalHeight*a,l=document,m=l.body,n=l.documentElement,o=f.pageXOffset||n.scrollLeft||m.scrollLeft,p=f.pageYOffset||n.scrollTop||m.scrollTop,q=d+o-f.positionLeft,r=f.originalWidth/2-q,s=r+g.currentLeft,t=s*(j/g.currentWidth)-s+g.currentLeft;(j-f.originalWidth)/2+h<c(s-r)&&(t=(j-f.originalWidth)/2+h,0>s-r&&(t*=-1));var u=e+p-f.positionTop,v=f.originalHeight/2-u,w=v+g.currentTop,x=w*(k/g.currentHeight)-w+g.currentTop;(k-f.originalHeight)/2+i<c(w-v)&&(x=(k-f.originalHeight)/2+i,0>w-v&&(x*=-1)),a===this.content.minScale&&(t=x=0),console.log(t,x,this.content.$element.style.transform);var y={currentLeft:g.currentLeft,newLeft:t,currentTop:g.currentTop,newTop:x,currentScale:g.currentScale,newScale:a};return g.currentWidth=j,g.currentHeight=k,g.currentLeft=t,g.currentTop=x,g.currentScale=a,y},_transform:function(a){var b=a.currentLeft,c=a.newLeft,d=a.currentTop,e=a.newTop,f=a.currentScale,g=a.newScale;this.content.$element.style.transform="translate3d(".concat(c,"px, ").concat(e,"px, 0px) scale(").concat(g,")")},_zoom:function(b){var c=a(this.window.$element);this._transform(this._computeNewPosition(this._computeNewScale(b),{x:c.left+this.window.originalWidth/2,y:c.top+this.window.originalHeight/2}))},zoomUp:function(){this._zoom(-1)},zoomDown:function(){this._zoom(1)}},j.create=function(a,b){return new j(a,b)},j});