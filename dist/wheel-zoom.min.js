!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=e()}(this,(function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,l(i.key),i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t,e,n){return(e=l(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r,s,c=[],a=!0,l=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;a=!1}else for(;!(a=(i=r.call(n)).done)&&(c.push(i.value),c.length!==e);a=!0);}catch(t){l=!0,o=t}finally{try{if(!a&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return c}}(t,e)||c(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function l(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function h(t){var e=t.getBoundingClientRect(),n=document,i=n.body,o=n.documentElement,r=d(),s=u(),c=o.clientTop||i.clientTop||0,a=o.clientLeft||i.clientLeft||0;return{top:e.top+r-c,left:e.left+s-a}}function u(){var t=void 0!==window.pageXOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft}function d(){var t=void 0!==window.pageYOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop}function p(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(e,n,i)}function f(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.removeEventListener(e,n,i)}function m(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function g(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function v(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function b(t,e,n,i){t.style.transform="translate(".concat(e,"px, ").concat(n,"px) scale(").concat(i,")")}function y(t,e){e?t.style.transition="transform ".concat(e,"s"):t.style.removeProperty("transition")}function _(t,e,n,i,o,r){var s=o/2-(t+e-n)+i;return s*r-s+i}function w(t,e,n,i,o){switch(t){case"left":i/2-o<e/2&&(o=(i-e)/2);break;case"right":i/2+o<e/2&&(o=(i-e)/2*-1);break;default:if((i-e)/2+n<Math.abs(o))o=((i-e)/2+n)*(o<0?-1:1)}return o}function H(t){var e=h(t.$element);return{x:e.left+t.originalWidth/2-u(),y:e.top+t.originalHeight/2-d()}}var S={type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},minScale:null,maxScale:1,speed:50,zoomOnClick:!0,zoomOnDblClick:!1,smoothExtinction:.3,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1},T={smoothExtinction:.25,onGrab:null,onMove:null,onDrop:null},O=function(){function t(e,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};n(this,t),this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),this.viewport=e,this.content=i,this.options=Object.assign({},T,o),this.isGrab=!1,this.moveTimer=null,this.coordinates=null,this.coordinatesShift=null,this.isTouch=m(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},p(this.content.$element,this.events.grab,this._grabHandler,this.events.options)}return o(t,[{key:"destroy",value:function(){for(var t in f(this.content.$element,this.events.grab,this._grabHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}},{key:"_grabHandler",value:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(t.preventDefault(),this.isGrab=!0,this.coordinates={x:g(t),y:v(t)},this.coordinatesShift={x:0,y:0},p(document,this.events.drop,this._dropHandler,this.events.options),p(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab(t))}},{key:"_dropHandler",value:function(t){t.preventDefault(),this.isGrab=!1,f(document,this.events.drop,this._dropHandler),f(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop(t)}},{key:"_moveHandler",value:function(t){if(this.isTouch&&t.touches.length>1)return!1;t.preventDefault();var e=this.viewport,n=this.content,i=this.coordinatesShift,o=this.coordinates,r=this.options;i.x=g(t)-o.x,i.y=v(t)-o.y,o.x=g(t),o.y=v(t),clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){i.x=0,i.y=0}),50);var s=n.currentLeft+i.x,c=n.currentTop+i.y,a=(n.currentWidth-e.originalWidth)/2+n.correctX,l=(n.currentHeight-e.originalHeight)/2+n.correctY;Math.abs(s)<=a&&(n.currentLeft=s),Math.abs(c)<=l&&(n.currentTop=c),y(n.$element,this.options.smoothExtinction),b(n.$element,n.currentLeft,n.currentTop,n.currentScale),"function"==typeof r.onMove&&r.onMove(t)}}]),t}(),x="dblclick",P="wheel",k=function(){function t(e){n(this,t),this.target=e,this.subscribes={},this.coordsOnDown=null,this.pressingTimeout=null,this.firstClick=!0,this.fingersHypot=null,this.zoomPinchWasDetected=!1,this.isTouch=m(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this._downHandler=this._downHandler.bind(this),this._upHandler=this._upHandler.bind(this),this._wheelHandler=this._wheelHandler.bind(this),this._touchMoveHandler=this._touchMoveHandler.bind(this),this._touchEndHandler=this._touchEndHandler.bind(this),p(this.target,this.events.down,this._downHandler,this.events.options),p(this.target,this.events.up,this._upHandler,this.events.options),p(this.target,P,this._wheelHandler),this.isTouch&&(p(this.target,"touchmove",this._touchMoveHandler),p(this.target,"touchend",this._touchEndHandler))}return o(t,[{key:"on",value:function(t,e){return t in this.subscribes||(this.subscribes[t]=[]),this.subscribes[t].push(e),this}},{key:"destroy",value:function(){for(var t in f(this.target,this.events.down,this._downHandler,this.events.options),f(this.target,this.events.up,this._upHandler,this.events.options),f(this.target,P,this._wheelHandler,this.events.options),this.isTouch&&(f(this.target,"touchmove",this._touchMoveHandler),f(this.target,"touchend",this._touchEndHandler)),this)this.hasOwnProperty(t)&&(this[t]=null)}},{key:"_run",value:function(t,e){if(this.subscribes[t]){var n,i=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=c(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw r}}}}(this.subscribes[t]);try{for(i.s();!(n=i.n()).done;){(0,n.value)(e)}}catch(t){i.e(t)}finally{i.f()}}}},{key:"_downHandler",value:function(t){this.coordsOnDown=null,(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnDown={x:g(t),y:v(t)}),clearTimeout(this.pressingTimeout)}},{key:"_upHandler",value:function(t){var e=this,n=this.subscribes[x]?200:0;this.firstClick?(this.pressingTimeout=setTimeout((function(){e.coordsOnDown&&e.coordsOnDown.x===g(t)&&e.coordsOnDown.y===v(t)&&e._run("click",t),e.firstClick=!0}),n),this.firstClick=!1):this.pressingTimeout=setTimeout((function(){e._run(x,t),e.firstClick=!0}),n/2)}},{key:"_wheelHandler",value:function(t){this._run(P,t)}},{key:"_touchMoveHandler",value:function(t){if(2===t.targetTouches.length){var n=t.targetTouches[0].clientX,i=t.targetTouches[0].clientY,o=t.targetTouches[1].clientX,r=t.targetTouches[1].clientY,s=Math.round(Math.sqrt(Math.pow(Math.abs(n-o),2)+Math.pow(Math.abs(i-r),2))),c=0;if(s>this.fingersHypot+5&&(c=-1),s<this.fingersHypot-5&&(c=1),0!==c){if(null!==this.fingersHypot||1===c){var a=Math.min(n,o)+Math.abs(n-o)/2,l=Math.min(i,r)+Math.abs(i-r)/2;t.data=e(e({},t.data||{}),{},{clientX:a,clientY:l,direction:c}),this._run("pinchtozoom",t)}this.fingersHypot=s,this.zoomPinchWasDetected=!0}}}},{key:"_touchEndHandler",value:function(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}}]),t}();function W(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeScale=this._computeScale.bind(this),this._computePosition=this._computePosition.bind(this),this._transform=this._transform.bind(this),this.content={},"string"==typeof t)this.content.$element=document.querySelector(t);else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}this.content.$element&&(this.viewport={},this.viewport.$element=this.content.$element.parentElement,this.options=M(e,S,this),this.isTouch=m(),this.direction=1,this.content.dragScrollable=null,this.content.elementInteractor=null,"image"===this.options.type?this.content.$element.complete?this._init():p(this.content.$element,"load",this._init,{once:!0}):this._init())}function M(t,e,n){var i=Object.assign({},e,t),o=Object.assign({},i.dragScrollableOptions);return"function"==typeof o.onGrab&&(i.dragScrollableOptions.onGrab=function(t){return o.onGrab(t,n)}),"function"==typeof o.onMove&&(i.dragScrollableOptions.onMove=function(t){return o.onMove(t,n)}),"function"==typeof o.onDrop&&(i.dragScrollableOptions.onDrop=function(t){return o.onDrop(t,n)}),i.smoothExtinction=Number(i.smoothExtinction)||S.smoothExtinction,i.dragScrollableOptions&&(i.dragScrollableOptions.smoothExtinction=Number(i.dragScrollableOptions.smoothExtinction)||T.smoothExtinction),i.minScale&&i.minScale>=i.maxScale&&(i.minScale=null),i}return W.prototype={constructor:W,_init:function(){var t=this,e=this.viewport,n=this.content,i=this.options;if(this._prepare(),n.elementInteractor&&n.elementInteractor.destroy(),n.elementInteractor=new k(n.$element),!0===i.dragScrollable&&(n.dragScrollable&&n.dragScrollable.destroy(),n.dragScrollable=new O(e,n,i.dragScrollableOptions)),i.disableWheelZoom||(this.isTouch&&n.elementInteractor.on("pinchtozoom",(function(e){var n=e.data,i=n.clientX,o=n.clientY,r=n.direction,s=t._computeScale(r);t._computePosition(s,i,o),t._transform()})),n.elementInteractor.on("wheel",(function(e){e.preventDefault();var n=i.reverseWheelDirection?-e.deltaY:e.deltaY,o=t._computeScale(n);t._computePosition(o,g(e),v(e)),t._transform()}))),i.zoomOnClick||i.zoomOnDblClick){var o=i.zoomOnDblClick?"dblclick":"click";n.elementInteractor.on(o,(function(e){var i=1===t.direction?n.maxScale:n.minScale;t._computePosition(i,g(e),v(e)),t._transform(),t.direction*=-1}))}},_prepare:function(){var t=this.viewport,e=this.content,n=this.options,i=h(t.$element),o=i.left,r=i.top;t.originalWidth=t.$element.offsetWidth,t.originalHeight=t.$element.offsetHeight,t.originalLeft=o,t.originalTop=r,"image"===n.type?(e.originalWidth=n.width||e.$element.naturalWidth,e.originalHeight=n.height||e.$element.naturalHeight):(e.originalWidth=n.width||e.$element.offsetWidth,e.originalHeight=n.height||e.$element.offsetHeight),e.minScale=n.minScale||Math.min(t.originalWidth/e.originalWidth,t.originalHeight/e.originalHeight),e.maxScale=n.maxScale,e.currentScale=e.minScale,e.currentWidth=e.originalWidth*e.currentScale,e.currentHeight=e.originalHeight*e.currentScale;var c=function(t,e,n){var i=0,o=0;switch(n){case"top":o=(e.currentHeight-t.originalHeight)/2;break;case"right":i=(e.currentWidth-t.originalWidth)/2*-1;break;case"bottom":o=(e.currentHeight-t.originalHeight)/2*-1;break;case"left":i=(e.currentWidth-t.originalWidth)/2}return[i,o]}(t,e,n.alignContent),a=s(c,2);e.alignPointX=a[0],e.alignPointY=a[1],e.currentLeft=e.alignPointX,e.currentTop=e.alignPointY;var l=function(t,e,n){var i=Math.max(0,(t.originalWidth-e.currentWidth)/2),o=Math.max(0,(t.originalHeight-e.currentHeight)/2);switch(n){case"top":o=0;break;case"right":i=0;break;case"bottom":o*=2;break;case"left":i*=2}return[i,o]}(t,e,n.alignContent),u=s(l,2);e.correctX=u[0],e.correctY=u[1],"function"==typeof n.prepare&&n.prepare(this),this._transform()},_computeScale:function(t){this.direction=t<0?1:-1;var e=this.content,n=e.minScale,i=e.maxScale,o=e.currentScale+this.direction/this.options.speed;return o<n?(this.direction=1,n):o>i?(this.direction=-1,i):o},_computePosition:function(t,e,n){var i=this.viewport,o=this.content,r=this.options,s=this.direction,c=o.originalWidth*t,a=o.originalHeight*t,l=u(),h=d(),p=_(e,l,i.originalLeft,o.currentLeft,i.originalWidth,c/o.currentWidth),f=_(n,h,i.originalTop,o.currentTop,i.originalHeight,a/o.currentHeight);-1===s&&(p=w(r.alignContent,i.originalWidth,o.correctX,c,p),f=w(r.alignContent,i.originalHeight,o.correctY,a,f)),t===o.minScale&&(p=o.alignPointX,f=o.alignPointY),o.currentWidth=c,o.currentHeight=a,o.currentLeft=p,o.currentTop=f,o.currentScale=t},_transform:function(){y(this.content.$element,this.options.smoothExtinction),b(this.content.$element,this.content.currentLeft,this.content.currentTop,this.content.currentScale),"function"==typeof this.options.rescale&&this.options.rescale(this)},_zoom:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};void 0!==e.x&&void 0!==e.y||(e=H(this.viewport)),this._computePosition(t,e.x,e.y),this._transform()},prepare:function(){this._prepare()},transform:function(t,e,n){var i=this.content;i.currentWidth=i.originalWidth*n,i.currentHeight=i.originalHeight*n,i.currentLeft=e,i.currentTop=t,i.currentScale=n,this._transform()},zoomUp:function(){this._zoom(this._computeScale(-1))},zoomDown:function(){this._zoom(this._computeScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},zoomUpToPoint:function(t){this._zoom(this._computeScale(-1),t)},zoomDownToPoint:function(t){this._zoom(this._computeScale(1),t)},maxZoomUpToPoint:function(t){this._zoom(this.content.maxScale,t)},destroy:function(){var t,e;for(var n in this.content.$element.style.removeProperty("transition"),this.content.$element.style.removeProperty("transform"),"image"===this.options.type&&f(this.content.$element,"load",this._init),null===(t=this.content.elementInteractor)||void 0===t||t.destroy(),null===(e=this.content.dragScrollable)||void 0===e||e.destroy(),this)this.hasOwnProperty(n)&&(this[n]=null)}},W.create=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new W(t,e)},W}));