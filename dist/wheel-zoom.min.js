!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=n()}(this,(function(){"use strict";function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var i,o,s=[],r=!0,h=!1;try{for(e=e.call(t);!(r=(i=e.next()).done)&&(s.push(i.value),!n||s.length!==n);r=!0);}catch(t){h=!0,o=t}finally{try{r||null==e.return||e.return()}finally{if(h)throw o}}return s}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}function e(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function i(t){var n=t.getBoundingClientRect(),e=document,i=e.body,r=e.documentElement,h=s(),c=o(),a=r.clientTop||i.clientTop||0,l=r.clientLeft||i.clientLeft||0;return{top:n.top+h-a,left:n.left+c-l}}function o(){var t=void 0!==window.pageXOffset,n="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:n?document.documentElement.scrollLeft:document.body.scrollLeft}function s(){var t=void 0!==window.pageYOffset,n="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:n?document.documentElement.scrollTop:document.body.scrollTop}function r(t,n){if(t&&n)for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function h(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.addEventListener(n,e,i)}function c(t,n,e){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.removeEventListener(n,e,i)}function a(){return"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0}function l(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function u(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}function p(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._dropHandler=this._dropHandler.bind(this),this._grabHandler=this._grabHandler.bind(this),this._moveHandler=this._moveHandler.bind(this),e.smoothExtinction=Number(e.smoothExtinction),isNaN(e.smoothExtinction)&&(e.smoothExtinction=.25),this.options=r({smoothExtinction:.25,onGrab:null,onMove:null,onDrop:null},e),this.isTouch=a(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},this.window=t,this.content=n,h(this.content.$element,this.events.grab,this._grabHandler,this.events.options)}p.prototype={constructor:p,window:null,content:null,isTouch:!1,isGrab:!1,events:null,moveTimer:null,options:{},coordinates:null,speed:null,_grabHandler:function(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(t.preventDefault(),this.isGrab=!0,this.coordinates={left:l(t),top:u(t)},this.speed={x:0,y:0},h(document,this.events.drop,this._dropHandler,this.events.options),h(document,this.events.move,this._moveHandler,this.events.options),"function"==typeof this.options.onGrab&&this.options.onGrab(t))},_dropHandler:function(t){t.preventDefault(),this.isGrab=!1,c(document,this.events.drop,this._dropHandler),c(document,this.events.move,this._moveHandler),"function"==typeof this.options.onDrop&&this.options.onDrop(t)},_moveHandler:function(t){if(this.isTouch&&t.touches.length>1)return!1;t.preventDefault();var n=this.window,e=this.content,i=this.speed,o=this.coordinates,s=this.options;i.x=l(t)-o.left,i.y=u(t)-o.top,clearTimeout(this.moveTimer),this.moveTimer=setTimeout((function(){i.x=0,i.y=0}),50);var r=e.currentLeft+i.x,h=e.currentTop+i.y,c=(e.currentWidth-n.originalWidth)/2+e.correctX,a=(e.currentHeight-n.originalHeight)/2+e.correctY;Math.abs(r)<=c&&(e.currentLeft=r),Math.abs(h)<=a&&(e.currentTop=h),function(t,n,e){var i=n.left,o=n.top,s=n.scale;e.smoothExtinction?t.style.transition="transform ".concat(e.smoothExtinction,"s"):t.style.removeProperty("transition");t.style.transform="translate3d(".concat(i,"px, ").concat(o,"px, 0px) scale(").concat(s,")")}(e.$element,{left:e.currentLeft,top:e.currentTop,scale:e.currentScale},this.options),o.left=l(t),o.top=u(t),"function"==typeof s.onMove&&s.onMove(t)},destroy:function(){for(var t in c(this.content.$element,this.events.grab,this._grabHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}};var d="dblclick",m="wheel";function f(t){this.target=t,this.subscribes={},this.coordsOnDown=null,this.pressingTimeout=null,this.firstClick=!0,this.isTouch=a(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this._downHandler=this._downHandler.bind(this),this._upHandler=this._upHandler.bind(this),this._wheelHandler=this._wheelHandler.bind(this),h(this.target,this.events.down,this._downHandler,this.events.options),h(this.target,this.events.up,this._upHandler,this.events.options),h(this.target,m,this._wheelHandler)}function g(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._init=this._init.bind(this),this._prepare=this._prepare.bind(this),this._computeNewScale=this._computeNewScale.bind(this),this._computeNewPosition=this._computeNewPosition.bind(this),this._transform=this._transform.bind(this),this._zoomTwoFingers_TouchmoveHandler=w.bind(this),this._zoomTwoFingers_TouchendHandler=v.bind(this),this.content={},this.window={},this.isTouch=!1,this.direction=1,this.options=null,this.dragScrollable=null,this.content.elementInteracter=null;var e={type:"image",width:null,height:null,dragScrollable:!0,dragScrollableOptions:{},minScale:null,maxScale:1,speed:50,zoomOnClick:!0,zoomOnDblClick:!1,watchImageChange:!0,smoothExtinction:.3,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1};if("string"==typeof t)this.content.$element=document.querySelector(t);else{if(!(t instanceof HTMLElement))throw"WZoom: `selectorOrHTMLElement` must be selector or HTMLElement, and not ".concat({}.toString.call(t));this.content.$element=t}if(this.isTouch=a(),this.content.$element)if(n.smoothExtinction=Number(n.smoothExtinction)||e.smoothExtinction,this.options=r(e,n),this.options.minScale&&this.options.minScale>=this.options.maxScale&&(this.options.minScale=null),this.window.$element=this.content.$element.parentNode,"image"===this.options.type){var i=!1;this.content.$element.complete&&(this._init(),i=!0),i&&!0!==this.options.watchImageChange||h(this.content.$element,"load",this._init,!this.options.watchImageChange&&{once:!0})}else this._init()}function w(t){if(2===t.targetTouches.length){var n=t.targetTouches[0].clientX,e=t.targetTouches[0].clientY,i=t.targetTouches[1].clientX,o=t.targetTouches[1].clientY,s=Math.round(Math.sqrt(Math.pow(Math.abs(n-i),2)+Math.pow(Math.abs(e-o),2))),r=0;if(s>this.fingersHypot+5&&(r=-1),s<this.fingersHypot-5&&(r=1),0!==r){if(null!==this.fingersHypot||1===r){var h=Math.min(n,i)+Math.abs(n-i)/2,c=Math.min(e,o)+Math.abs(e-o)/2;this._transform(this._computeNewPosition(this._computeNewScale(r),{x:h,y:c}))}this.fingersHypot=s,this.zoomPinchWasDetected=!0}}}function v(){this.zoomPinchWasDetected&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1)}function b(t,n,e,i,o,s){var r=o/2-(t+n-e)+i;return r*s-r+i}function y(t,n,e,i,o){switch(t.alignContent){case"left":i/2-o<n/2&&(o=(i-n)/2);break;case"right":i/2+o<n/2&&(o=(i-n)/2*-1);break;default:if((i-n)/2+e<Math.abs(o))o=((i-n)/2+e)*(o<0?-1:1)}return o}return f.prototype={constructor:f,on:function(t,n){return t in this.subscribes||(this.subscribes[t]=[]),this.subscribes[t].push(n),this},run:function(t,e){if(this.subscribes[t]){var i,o=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var o=0,s=function(){};return{s:s,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,h=!0,c=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return h=t.done,t},e:function(t){c=!0,r=t},f:function(){try{h||null==i.return||i.return()}finally{if(c)throw r}}}}(this.subscribes[t]);try{for(o.s();!(i=o.n()).done;){(0,i.value)(e)}}catch(t){o.e(t)}finally{o.f()}}},_downHandler:function(t){this.coordsOnDown=null,(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnDown={x:l(t),y:u(t)}),clearTimeout(this.pressingTimeout)},_upHandler:function(t){var n=this,e=this.subscribes.dblclick?200:0;this.firstClick?(this.pressingTimeout=setTimeout((function(){n.coordsOnDown&&n.coordsOnDown.x===l(t)&&n.coordsOnDown.y===u(t)&&n.run("click",t),n.firstClick=!0}),e),this.firstClick=!1):this.pressingTimeout=setTimeout((function(){n.run(d,t),n.firstClick=!0}),e/2)},_wheelHandler:function(t){this.run(m,t)},destroy:function(){for(var t in c(this.target,this.events.down,this._downHandler,this.events.options),c(this.target,this.events.up,this._upHandler,this.events.options),c(this.target,m,this._wheelHandler,this.events.options),this)this.hasOwnProperty(t)&&(this[t]=null)}},g.prototype={constructor:g,_init:function(){var t=this;if(this._prepare(),this.content.elementInteracter&&this.content.elementInteracter.destroy(),this.content.elementInteracter=new f(this.content.$element),!0===this.options.dragScrollable&&(this.dragScrollable&&this.dragScrollable.destroy(),this.setDragScrollable(new p(this.window,this.content,this.options.dragScrollableOptions))),this.options.disableWheelZoom||(this.isTouch&&(this.fingersHypot=null,this.zoomPinchWasDetected=!1,h(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),h(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),this.content.elementInteracter.on("wheel",(function(n){n.preventDefault();var e=t.options.reverseWheelDirection?-n.deltaY:n.deltaY;t._transform(t._computeNewPosition(t._computeNewScale(e),{x:l(n),y:u(n)}))}))),this.options.zoomOnClick||this.options.zoomOnDblClick){var n=this.options.zoomOnDblClick?"dblclick":"click";this.content.elementInteracter.on(n,(function(n){t._transform(t._computeNewPosition(1===t.direction?t.content.maxScale:t.content.minScale,{x:l(n),y:u(n)})),t.direction*=-1}))}},_prepare:function(){var n=i(this.window.$element);this.window.originalWidth=this.window.$element.offsetWidth,this.window.originalHeight=this.window.$element.offsetHeight,this.window.positionLeft=n.left,this.window.positionTop=n.top,"image"===this.options.type?(this.content.originalWidth=this.options.width||this.content.$element.naturalWidth,this.content.originalHeight=this.options.height||this.content.$element.naturalHeight):(this.content.originalWidth=this.options.width||this.content.$element.offsetWidth,this.content.originalHeight=this.options.height||this.content.$element.offsetHeight),this.content.minScale=this.options.minScale||Math.min(this.window.originalWidth/this.content.originalWidth,this.window.originalHeight/this.content.originalHeight),this.content.maxScale=this.options.maxScale,this.content.currentWidth=this.content.originalWidth*this.content.minScale,this.content.currentHeight=this.content.originalHeight*this.content.minScale;var e=function(t,n,e){var i=0,o=0;switch(t.alignContent){case"left":i=(n.currentWidth-e.originalWidth)/2;break;case"top":o=(n.currentHeight-e.originalHeight)/2;break;case"right":i=(n.currentWidth-e.originalWidth)/2*-1;break;case"bottom":o=(n.currentHeight-e.originalHeight)/2*-1}return[i,o]}(this.options,this.content,this.window),o=t(e,2),s=o[0],r=o[1];this.content.alignPointX=s,this.content.alignPointY=r;var h=function(t,n,e){var i=Math.max(0,(e.originalWidth-n.currentWidth)/2),o=Math.max(0,(e.originalHeight-n.currentHeight)/2);"left"===t.alignContent?i*=2:"right"===t.alignContent&&(i=0);"bottom"===t.alignContent?o*=2:"top"===t.alignContent&&(o=0);return[i,o]}(this.options,this.content,this.window),c=t(h,2),a=c[0],l=c[1];this.content.correctX=a,this.content.correctY=l,this.content.currentLeft=this.content.alignPointX,this.content.currentTop=this.content.alignPointY,this.content.currentScale=this.content.minScale,this.content.$element.style.transform="translate3d(".concat(this.content.alignPointX,"px, ").concat(this.content.alignPointY,"px, 0px) scale(").concat(this.content.minScale,")"),"function"==typeof this.options.prepare&&this.options.prepare()},_computeNewScale:function(t){this.direction=t<0?1:-1;var n=this.content,e=n.minScale,i=n.maxScale,o=n.currentScale+this.direction/this.options.speed;return o<e?this.direction=1:o>i&&(this.direction=-1),o<e?e:o>i?i:o},_computeNewPosition:function(t,n){var e=n.x,i=n.y,r=this.window,h=this.content,c=h.originalWidth*t,a=h.originalHeight*t,l=o(),u=s(),p=b(e,l,r.positionLeft,h.currentLeft,r.originalWidth,c/h.currentWidth),d=b(i,u,r.positionTop,h.currentTop,r.originalHeight,a/h.currentHeight);-1===this.direction&&(p=y(this.options,r.originalWidth,h.correctX,c,p),d=y(this.options,r.originalHeight,h.correctY,a,d)),t===this.content.minScale&&(p=this.content.alignPointX,d=this.content.alignPointY);var m={currentLeft:h.currentLeft,newLeft:p,currentTop:h.currentTop,newTop:d,currentScale:h.currentScale,newScale:t};return h.currentWidth=c,h.currentHeight=a,h.currentLeft=p,h.currentTop=d,h.currentScale=t,m},_transform:function(t){t.currentLeft;var n=t.newLeft;t.currentTop;var e=t.newTop;t.currentScale;var i=t.newScale;this.options.smoothExtinction?this.content.$element.style.transition="transform ".concat(this.options.smoothExtinction,"s"):this.content.$element.style.removeProperty("transition"),this.content.$element.style.transform="translate3d(".concat(n,"px, ").concat(e,"px, 0px) scale(").concat(i,")"),"function"==typeof this.options.rescale&&this.options.rescale()},_zoom:function(t,n){void 0!==n&&void 0!==n.x&&void 0!==n.y||(n=function(t){var n=i(t.$element);return{x:n.left+t.originalWidth/2-o(),y:n.top+t.originalHeight/2-s()}}(this.window)),this._transform(this._computeNewPosition(t,n))},prepare:function(){this._prepare()},zoomUp:function(){this._zoom(this._computeNewScale(-1))},zoomDown:function(){this._zoom(this._computeNewScale(1))},maxZoomUp:function(){this._zoom(this.content.maxScale)},maxZoomDown:function(){this._zoom(this.content.minScale)},zoomUpToPoint:function(t){this._zoom(this._computeNewScale(-1),t)},zoomDownToPoint:function(t){this._zoom(this._computeNewScale(1),t)},maxZoomUpToPoint:function(t){this._zoom(this.content.maxScale,t)},setDragScrollable:function(t){this.dragScrollable=t},destroy:function(){for(var t in this.content.$element.style.transform="","image"===this.options.type&&c(this.content.$element,"load",this._init),this.options.disableWheelZoom||this.isTouch&&(c(this.content.$element,"touchmove",this._zoomTwoFingers_TouchmoveHandler),c(this.content.$element,"touchend",this._zoomTwoFingers_TouchendHandler)),this.content.elementInteracter&&this.content.elementInteracter.destroy(),this.dragScrollable&&this.dragScrollable.destroy(),this)this.hasOwnProperty(t)&&(this[t]=null)}},g.create=function(t,n){return new g(t,n)},g}));