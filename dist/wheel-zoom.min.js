!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WZoom=e()}(this,(function(){"use strict";class t{x=0;y=0}function e(t){const e=t.getBoundingClientRect(),{body:n,documentElement:s}=document,r=o(),h=i(),c=s.clientTop||n.clientTop||0,a=s.clientLeft||n.clientLeft||0;return{top:e.top+r-c,left:e.left+h-a}}function i(){const t=void 0!==window.pageXOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageXOffset:e?document.documentElement.scrollLeft:document.body.scrollLeft}function o(){const t=void 0!==window.pageYOffset,e="CSS1Compat"===(document.compatMode||"");return t?window.pageYOffset:e?document.documentElement.scrollTop:document.body.scrollTop}function n(t,e,i,o=!1){t.addEventListener(e,i,o)}function s(t,e,i,o=!1){t.removeEventListener(e,i,o)}function r(){return"ontouchstart"in window||navigator.maxTouchPoints>0}function h(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientX:t.changedTouches[0].clientX}function c(t){return"wheel"===t.type||"pointerup"===t.type||"pointerdown"===t.type||"pointermove"===t.type||"mousedown"===t.type||"mousemove"===t.type||"mouseup"===t.type?t.clientY:t.changedTouches[0].clientY}class a{constructor(t){this.$element=t}$element;originalTop=0;originalLeft=0;originalHeight=0;originalWidth=0}function l(t,e,i,o,n,s){const r=n/2-(t+e-i)+o;return r*s-r+o}function d(t,e,i,o,n){switch(t){case"left":o/2-n<e/2&&(n=(o-e)/2);break;case"right":o/2+n<e/2&&(n=(o-e)/2*-1);break;default:if((o-e)/2+i<Math.abs(n)){n=((o-e)/2+i)*(n<0?-1:1)}}return n}class u{constructor(){this.subscribes={}}subscribes;on(t,e){return t in this.subscribes||(this.subscribes[t]=[]),this.subscribes[t].push(e),this}destroy(){for(let t in this)this.hasOwnProperty(t)&&delete this[t]}run(t,e){if(this.subscribes[t])for(const i of this.subscribes[t])i(e)}}const m="grab",p="move",g="drop";class f extends u{constructor(e){super(),this.target=e,this.moveTimer=-1,this.coordinates=new t,this.coordinatesShift=new t,this.isTouch=r(),this.events=this.isTouch?{grab:"touchstart",move:"touchmove",drop:"touchend"}:{grab:"mousedown",move:"mousemove",drop:"mouseup"},this.events.options=!!this.isTouch&&{passive:!1},this._dropHandler=this.dropHandler.bind(this),this._grabHandler=this.grabHandler.bind(this),this._moveHandler=this.moveHandler.bind(this),n(this.target,this.events.grab,this._grabHandler,this.events.options)}target;moveTimer;coordinates;coordinatesShift;events;_dropHandler;_grabHandler;_moveHandler;isTouch;destroy(){s(this.target,this.events.grab,this._grabHandler,this.events.options),super.destroy()}grabHandler(t){(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordinates={x:h(t),y:c(t)},this.coordinatesShift={x:0,y:0},n(document,this.events.drop,this._dropHandler,this.events.options),n(document,this.events.move,this._moveHandler,this.events.options),this.run(m,t))}dropHandler(t){s(document,this.events.drop,this._dropHandler),s(document,this.events.move,this._moveHandler),this.run(g,t)}moveHandler(t){if(this.isTouch&&t.touches.length>1)return!1;this.coordinatesShift.x=h(t)-this.coordinates.x,this.coordinatesShift.y=c(t)-this.coordinates.y,this.coordinates.x=h(t),this.coordinates.y=c(t),clearTimeout(this.moveTimer),this.moveTimer=setTimeout((()=>{this.coordinatesShift.x=0,this.coordinatesShift.y=0}),50),t.data={...t.data||{},x:this.coordinatesShift.x,y:this.coordinatesShift.y},this.run(p,t)}}const v="click",H="dblclick",b="wheel";class y extends u{constructor(t){super(),this.target=t,this.coordsOnDown=void 0,this.pressingTimeout=-1,this.firstClick=!0,this.isTouch=r(),this.events=this.isTouch?{down:"touchstart",up:"touchend"}:{down:"mousedown",up:"mouseup"},this.events.options=!!this.isTouch&&{passive:!0},this._downHandler=this.downHandler.bind(this),this._upHandler=this.upHandler.bind(this),this._wheelHandler=this.wheelHandler.bind(this),n(this.target,this.events.down,this._downHandler,this.events.options),n(this.target,this.events.up,this._upHandler,this.events.options),n(this.target,b,this._wheelHandler)}destroy(){s(this.target,this.events.down,this._downHandler,this.events.options),s(this.target,this.events.up,this._upHandler,this.events.options),s(this.target,b,this._wheelHandler,this.events.options),super.destroy()}target;coordsOnDown;pressingTimeout;firstClick;isTouch;events;_downHandler;_upHandler;_wheelHandler;downHandler(t){this.coordsOnDown=void 0,(this.isTouch&&1===t.touches.length||1===t.buttons)&&(this.coordsOnDown={x:h(t),y:c(t)}),clearTimeout(this.pressingTimeout)}upHandler(t){const e=this.subscribes[H]?setTimeout:(t,e)=>t();this.firstClick?(this.firstClick=!1,this.pressingTimeout=e((()=>{this.isDetectedShift(t)||this.run(v,t),this.firstClick=!0}),200)):this.pressingTimeout=e((()=>{this.isDetectedShift(t)||this.run(H,t),this.firstClick=!0}),100)}wheelHandler(t){this.run(b,t)}isDetectedShift(t){return!(this.coordsOnDown&&this.coordsOnDown?.x===h(t)&&this.coordsOnDown?.y===c(t))}}const w="pinchtozoom";class T extends u{constructor(t){super(),this.target=t,this.fingersHypot=0,this.zoomPinchWasDetected=!1,this._touchMoveHandler=this.touchMoveHandler.bind(this),this._touchEndHandler=this.touchEndHandler.bind(this),n(this.target,"touchmove",this._touchMoveHandler),n(this.target,"touchend",this._touchEndHandler)}destroy(){s(this.target,"touchmove",this._touchMoveHandler),s(this.target,"touchend",this._touchEndHandler),super.destroy()}target;fingersHypot;zoomPinchWasDetected;_touchMoveHandler;_touchEndHandler;touchMoveHandler(t){if(2===t.targetTouches.length){const e=t.targetTouches[0].clientX,i=t.targetTouches[0].clientY,o=t.targetTouches[1].clientX,n=t.targetTouches[1].clientY,s=Math.round(Math.sqrt(Math.pow(Math.abs(e-o),2)+Math.pow(Math.abs(i-n),2)));let r=0;if(s>this.fingersHypot+5&&(r=-1),s<this.fingersHypot-5&&(r=1),0!==r){if(null!==this.fingersHypot||1===r){const s=Math.min(e,o)+Math.abs(e-o)/2,h=Math.min(i,n)+Math.abs(i-n)/2;t.data={...t.data||{},clientX:s,clientY:h,direction:r},this.run(w,t)}this.fingersHypot=s,this.zoomPinchWasDetected=!0}}}touchEndHandler(){this.zoomPinchWasDetected&&(this.fingersHypot=0,this.zoomPinchWasDetected=!1)}}const S={type:"image",width:void 0,height:void 0,minScale:void 0,maxScale:1,speed:1.1,zoomOnClick:!0,zoomOnDblClick:!1,smoothTime:.25,alignContent:"center",disableWheelZoom:!1,reverseWheelDirection:!1,dragScrollable:!0};class _{constructor(t){if("string"==typeof t){if(this.$element=document.querySelector(t),!this.$element)throw`Zoom: Element with selector \`${t}\` not found`}else{if(!(t instanceof HTMLElement))throw`Zoom: \`selectorOrHTMLElement\` must be selector or HTMLElement, and not ${{}.toString.call(t)}`;this.$element=t}}getParent(){return this.$element.parentElement}$element;currentLeft=0;currentTop=0;currentWidth=0;currentHeight=0;currentScale=0;originalHeight=0;originalWidth=0;originalScale=0;alignPointX=0;alignPointY=0;correctX=0;correctY=0;minScale=0;maxScale=0}class W{constructor(t,e={}){this.content=new _(t),this.init=this.init.bind(this),this.prepare=this.prepare.bind(this),this.computeScale=this.computeScale.bind(this),this.transform=this.transform.bind(this),this.viewport=new a(this.content.getParent()),this.options=function(t,e){const i=Object.assign({},e,t);if(r())i.smoothTime=0,i.smoothTimeDrag=0;else{const t=Number(i.smoothTime),e=Number(i.smoothTimeDrag);i.smoothTime=isNaN(t)?S.smoothTime:t,i.smoothTimeDrag=isNaN(e)?i.smoothTime:e}return i}(e,S),this.isTouch=r(),this.direction=1,this.observers=[],"image"===this.options.type?this.content.$element.complete?this.init():n(this.content.$element,"load",this.init,{once:!0}):this.init()}content;viewport;options;observers;direction;isTouch;init(){const{viewport:t,content:e,options:i,observers:o}=this;if(this.prepare(),this.destroyObservers(),!0===i.dragScrollable){const n=new f(e.$element);o.push(n),"function"==typeof i.onGrab&&n.on(m,(t=>{t.preventDefault(),i.onGrab&&i.onGrab(t,this)})),"function"==typeof i.onDrop&&n.on(g,(t=>{t.preventDefault(),i.onDrop&&i.onDrop(t,this)})),n.on(p,(o=>{o.preventDefault();const{x:n,y:s}=o.data,r=e.currentLeft+n,h=e.currentTop+s;let c=(e.currentWidth-t.originalWidth)/2+e.correctX,a=(e.currentHeight-t.originalHeight)/2+e.correctY;Math.abs(r)<=c&&(e.currentLeft=r),Math.abs(h)<=a&&(e.currentTop=h),this._transform(i.smoothTimeDrag),"function"==typeof i.onMove&&i.onMove(o,this)}))}const n=new y(e.$element);if(o.push(n),!i.disableWheelZoom)if(this.isTouch){const t=new T(e.$element);o.push(t),t.on(w,(t=>{const{clientX:e,clientY:i,direction:o}=t.data,n=this.computeScale(o);this.computePosition(n,e,i),this._transform()}))}else n.on(b,(t=>{t.preventDefault();const e=i.reverseWheelDirection?-t.deltaY:t.deltaY,o=this.computeScale(e);this.computePosition(o,h(t),c(t)),this._transform()}));if(i.zoomOnClick||i.zoomOnDblClick){const t=i.zoomOnDblClick?H:v;n.on(t,(t=>{const i=1===this.direction?e.maxScale:e.minScale;this.computePosition(i,h(t),c(t)),this._transform(),this.direction*=-1}))}}_prepare(){const{viewport:t,content:i,options:o}=this,{left:n,top:s}=e(t.$element);t.originalWidth=t.$element.offsetWidth,t.originalHeight=t.$element.offsetHeight,t.originalLeft=n,t.originalTop=s,"image"===o.type?(i.originalWidth=o.width||i.$element?.naturalWidth,i.originalHeight=o.height||i.$element?.naturalHeight):(i.originalWidth=o.width||i.$element?.offsetWidth,i.originalHeight=o.height||i.$element?.offsetHeight),i.maxScale=o.maxScale,i.minScale=o.minScale||Math.min(t.originalWidth/i.originalWidth,t.originalHeight/i.originalHeight,i.maxScale),i.currentScale=i.minScale,i.currentWidth=i.originalWidth*i.currentScale,i.currentHeight=i.originalHeight*i.currentScale,[i.alignPointX,i.alignPointY]=function(t,e,i){let o=0,n=0;switch(i){case"top":n=(e.currentHeight-t.originalHeight)/2;break;case"right":o=(e.currentWidth-t.originalWidth)/2*-1;break;case"bottom":n=(e.currentHeight-t.originalHeight)/2*-1;break;case"left":o=(e.currentWidth-t.originalWidth)/2}return[o,n]}(t,i,o.alignContent),i.currentLeft=i.alignPointX,i.currentTop=i.alignPointY,[i.correctX,i.correctY]=function(t,e,i){let o=Math.max(0,(t.originalWidth-e.currentWidth)/2),n=Math.max(0,(t.originalHeight-e.currentHeight)/2);switch(i){case"top":n=0;break;case"right":o=0;break;case"bottom":n*=2;break;case"left":o*=2}return[o,n]}(t,i,o.alignContent),"function"==typeof o.prepare&&o.prepare(this),this._transform()}computeScale(t){this.direction=t<0?1:-1;const{minScale:e,maxScale:i,currentScale:o}=this.content,n=o*Math.pow(this.options.speed,this.direction);return n<=e?(this.direction=1,e):n>=i?(this.direction=-1,i):n}computePosition(t,e,n){const{viewport:s,content:r,options:h,direction:c}=this,a=r.originalWidth*t,u=r.originalHeight*t,m=i(),p=o();let g=l(e,m,s.originalLeft,r.currentLeft,s.originalWidth,a/r.currentWidth),f=l(n,p,s.originalTop,r.currentTop,s.originalHeight,u/r.currentHeight);-1===c&&(g=d(h.alignContent,s.originalWidth,r.correctX,a,g),f=d(h.alignContent,s.originalHeight,r.correctY,u,f)),t===r.minScale&&(g=r.alignPointX,f=r.alignPointY),r.currentWidth=a,r.currentHeight=u,r.currentLeft=g,r.currentTop=f,r.currentScale=t}_transform(t){var e,i;void 0===t&&(t=this.options.smoothTime),e=this.content.$element,(i=t)?e.style.transition=`transform ${i}s`:e.style.removeProperty("transition"),function(t,e,i,o){t.style.transform=`translate(${e}px, ${i}px) scale(${o})`}(this.content.$element,this.content.currentLeft,this.content.currentTop,this.content.currentScale),"function"==typeof this.options.rescale&&this.options.rescale(this)}zoom(t,n){void 0===n&&(n=function(t){const n=e(t.$element);return{x:n.left+t.originalWidth/2-i(),y:n.top+t.originalHeight/2-o()}}(this.viewport)),this.computePosition(t,n?.x,n?.y),this._transform()}destroyObservers(){for(const t of this.observers)t.destroy()}prepare(){this._prepare()}transform(t,e,i){const{content:o}=this;o.currentWidth=o.originalWidth*i,o.currentHeight=o.originalHeight*i,o.currentLeft=e,o.currentTop=t,o.currentScale=i,this._transform()}zoomUp(){this.zoom(this.computeScale(-1))}zoomDown(){this.zoom(this.computeScale(1))}maxZoomUp(){this.zoom(this.content.maxScale)}maxZoomDown(){this.zoom(this.content.minScale)}zoomUpToPoint(t){this.zoom(this.computeScale(-1),t)}zoomDownToPoint(t){this.zoom(this.computeScale(1),t)}maxZoomUpToPoint(t){this.zoom(this.content.maxScale,t)}destroy(){this.content.$element.style.removeProperty("transition"),this.content.$element.style.removeProperty("transform"),"image"===this.options.type&&s(this.content.$element,"load",this.init),this.destroyObservers();for(let t in this)this.hasOwnProperty(t)&&delete this[t]}static create(t,e={}){return new W(t,e)}}return W}));